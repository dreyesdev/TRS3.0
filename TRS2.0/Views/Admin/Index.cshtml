@model TRS2._0.Models.ViewModels.AdminIndexViewModel

@{
    ViewData["Title"] = "Admin Index";
}

<h1>Admin Index</h1>

<!-- Sección de Generar PM Values -->
<h2>Generar Valores PM</h2>
<form asp-action="GeneratePMValues" method="post" class="form-inline">
    <div class="form-group mb-2">
        <label for="year" class="sr-only">Year</label>
        <input type="number" name="year" class="form-control" placeholder="Year" required />
    </div>
    <div class="form-group mx-sm-3 mb-2">
        <label for="month" class="sr-only">Month</label>
        <input type="number" name="month" class="form-control" placeholder="Month" required />
    </div>
    <button type="submit" class="btn btn-primary mb-2">Generate PM Values</button>
</form>

<!-- Sección de PM Values -->
<h2>Valores PM Diarios</h2>
<table class="table">
    <thead>
        <tr>
            <th>Year</th>
            <th>Month</th>
            <th>Workable Days</th>
            <th>PM per Day</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var pm in Model.DailyPMValues)
        {
            <tr>
                <td>@pm.Year</td>
                <td>@pm.Month</td>
                <td>@pm.WorkableDays</td>
                <td>@pm.PmPerDay</td>
            </tr>
        }
    </tbody>
</table>

<!-- Sección de Asignación de PM Diario -->
<h2>Calcular PM Diario</h2>
<form asp-action="CalculateDailyPM" method="post" class="form-inline">
    <div class="form-group mb-2">
        <label for="personId" class="sr-only">Persona</label>
        <select name="personId" class="form-control" required>
            @foreach (var person in Model.People)
            {
                <option value="@person.Value">@person.Text</option>
            }
        </select>
    </div>
    <div class="form-group mx-sm-3 mb-2">
        <label for="date" class="sr-only">Fecha</label>
        <input type="date" name="date" class="form-control" required />
    </div>
    <button type="submit" class="btn btn-primary mb-2">Calcular PM Diario</button>
</form>

<!-- Sección de Asignación de PM Mensual -->
<h2>Calcular PM Mensual</h2>
<form asp-action="CalculateMonthlyPM" method="post" class="form-inline">
    <div class="form-group mb-2">
        <label for="personId" class="sr-only">Persona</label>
        <select name="personId" class="form-control" required>
            @foreach (var person in Model.People)
            {
                <option value="@person.Value">@person.Text</option>
            }
        </select>
    </div>
    <div class="form-group mx-sm-3 mb-2">
        <label for="date" class="sr-only">Fecha</label>
        <input type="month" name="date" class="form-control" required />
    </div>
    <button type="submit" class="btn btn-primary mb-2">Calcular PM Mensual</button>
</form>

<!-- Sección de Asignación de Roles -->
<h2>Gestionar Roles de Usuario</h2>
<table class="table">
    <thead>
        <tr>
            <th>Username</th>
            <th>Role</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var user in Model.Users)
        {
            <tr>
                <td>@user.Text</td>
                <td>
                    <form asp-action="AssignRole" method="post">
                        <input type="hidden" name="userId" value="@user.Value" />
                        <select name="role" class="form-select">
                            @foreach (var role in Model.Roles)
                            {
                                <option value="@role.Value">@role.Text</option>
                            }
                        </select>
                        <button type="submit" class="btn btn-primary">Assign Role</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>
@section Scripts {
    <script>
        function generatePMValues() {
            var year = $('#yearSelector').val();
            var month = $('#monthSelector').val();
            $.ajax({
                url: '@Url.Action("GeneratePMValues", "Admin")',
                type: 'POST',
                data: { year: year, month: month },
                success: function (response) {
                    if (response.success) {
                        alert('Valores PM generados con éxito.');
                        location.reload();
                        // Puedes optar por recargar la página o actualizar una tabla de valores PM si es necesario
                    } else {
                        alert('Error al generar valores PM: ' + response.message);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Error al generar valores PM: ' + error);
                }
            });
        }

        function updateDailyPMValues() {
            $.ajax({
                url: '@Url.Action("DailyPMValuesList", "Admin")',
                success: function (data) {
                    $('#dailyPmValuesContainer').html(data);
                }
            });
        }

        $('#calculateDailyPM').click(function () {
            var personId = $('#personSelector').val();
            var date = $('#dateSelector').val();
            $.post('@Url.Action("CalculateDailyPM", "Admin")', { personId: personId, date: date }, function (data) {
                $('#dailyPMResult').text(data);
            });
        });

        $('#calculateMonthlyPM').click(function () {
            var personId = $('#personSelector').val();
            var date = $('#dateSelector').val();
            $.post('@Url.Action("CalculateMonthlyPM", "Admin")', { personId: personId, date: date }, function (data) {
                $('#monthlyPMResult').text(data);
            });
        });

        function generateYearlyPMValues() {
            var year = $('#yearSelector').val();
            $.ajax({
                url: '@Url.Action("GenerateYearlyPMValues", "Admin")',
                type: 'POST',
                data: { year: year },
                success: function (response) {
                    if (response.success) {
                        alert('Valores PM anuales generados con éxito.');
                        location.reload(); // Actualizar la tabla de valores PM
                    } else {
                        alert('Error al generar valores PM anuales: ' + response.message);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Error al generar valores PM anuales: ' + error);
                }
            });
        }
    </script>
}
