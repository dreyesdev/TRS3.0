@model TRS2._0.Models.ViewModels.TimesheetViewModel
@using System.Globalization
@using TRS2._0.Models.DataModels

@{
    ViewData["Title"] = "Timesheet Overview";
    var monthName = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(@Model.CurrentMonth);
    var monthNameCapitalized = new DateTime(Model.CurrentYear, Model.CurrentMonth, 1)
        .ToString("MMMM", System.Globalization.CultureInfo.CreateSpecificCulture("en"));
}
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<div class="container-fluid timesheet-ux" style="max-width: 2000px; padding-right: 5px; padding-left: 5px; margin-right: auto; margin-left: auto;">
    <h2 class="timesheet-page-title">Timesheet for @Model.Person.Name @Model.Person.Surname · @monthNameCapitalized @Model.CurrentYear</h2>

    <div class="timesheet-control-panel mb-3">
        <div class="timesheet-nav-group">
            <button id="prevMonthButton" class="btn btn-primary">Previous</button>
            <button id="nextMonthButton" class="btn btn-primary">Next</button>

            <select id="monthSelect" class="form-control">
                <option value="">Select month</option>
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>
            <select id="yearSelect" class="form-control">
                @for (int year = DateTime.Now.Year - 10; year <= DateTime.Now.Year + 10; year++)
                {
                    <option value="@year">@year</option>
                }
            </select>
            <div id="yearQuickSelectInline" class="year-quick-select-inline" aria-label="Quick year selector"></div>
            <button id="goButton" class="btn btn-success">Go</button>
        </div>

        <div id="yearQuickSelect" class="year-quick-select" aria-label="Quick year selector"></div>

        @if ((bool?)ViewBag.AllowEdit == true)
        {
            <div class="timesheet-actions-group">
                <button id="saveAllButton" class="btn btn-success">Save All</button>

                @if ((bool?)ViewBag.ShowAutoFillButton == true)
                {
                    <button id="autoFillButton" class="btn btn-warning">Auto Fill</button>
                }
            </div>
        }

        <div class="timesheet-progress-wrap">
            <span class="font-weight-bold total-hours-label">Total Hours this month: @Model.TotalHours.ToString("0.0")</span>
            <div class="progress w-100 position-relative timesheet-progress-bar">
                <div class="progress-bar bg-success" role="progressbar" style="width: @ViewBag.PercentageUsed%" aria-valuenow="@ViewBag.PercentageUsed" aria-valuemin="0" aria-valuemax="100">
                    <span class="position-absolute w-100 text-center font-weight-bold" style="color: black;">@ViewBag.PercentageUsed%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="table-responsive">
        <div class="scrollable-table-container">
            <table id="timesheetTable" class="table table-bordered table-striped table-hover">
                <!-- El resto de tu tabla aquí -->

                <thead class="thead-dark">
                    <tr>
                        <th class="sticky-column sticky-header top-left-header">
                            <div class="header-top-line">Project</div>
                            <div style="text-align: center;">WP - Title</div>

                        </th>
                        @* <th>Dedication - Estimated Hours</th> *@
                        @foreach (var day in Model.MonthDays)
                        {
                            <th class="sticky-day-header">
                                <div style="border-bottom: 1px solid white; margin-bottom: 2px; margin-top: 8px; text-align: center;">@day.Day.ToString("00")</div>
                                <div style="text-align: center;">@day.ToString("ddd", CultureInfo.CreateSpecificCulture("en")).ToUpper()</div>
                            </th>
                        }
                        <th class="sticky-penultimate-column sticky-summary-column">
                            <div style="border-bottom: 1px solid white; margin-bottom: 2px; text-align: center; font-weight: bold">ACTUAL</div>
                            <div style="text-align: center; font-weight: bold;">ESTIMATED HOURS
                                <span class="timesheet-help" tabindex="0" role="button" aria-label="Help about estimated hours" data-tooltip="Estimated hours are calculated from your monthly effort percentage. Because this is a conversion to hours and rounding is applied, small differences above or below the estimate are expected and not a problem.">?</span>
                            </div>
                        </th>
                        <th class="sticky-last-column sticky-percent-column">%</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var wp in Model.WorkPackages)
                    {
                        <tr>
                            <td class="single-line-cell sticky-column">

                                <div class="header-top-line body-top-line">@* @wp.ProjectSAPCode*@@wp.ProjectName</div>
                                <div class="wp-title-cell">@wp.WpName - @wp.WpTitle</div>

                            </td>

                            @* <td class="second-line-cell">
                                Dedication: @String.Format("{0:P1}", wp.Effort) - Estimated Hours: @wp.EstimatedHours
                            </td> *@

                            <!-- Celdas para cada día del mes -->
                            @foreach (var day in Model.MonthDays)
                            {
                                var isWeekend = day.DayOfWeek == DayOfWeek.Saturday || day.DayOfWeek == DayOfWeek.Sunday;
                                var leave = Model.LeavesthisMonth.FirstOrDefault(l => l.Day.Date == day.Date);
                                var hasTravel = Model.TravelsthisMonth.Any(t => day.Date >= t.StartDate && day.Date <= t.EndDate);
                                var isFuture = day.Date > DateTime.Now.Date;
                                var isHoliday = Model.Holidays.Any(h => h.Date == day.Date);
                                var cellStyle = "";
                                var hasTravelforthisProject = Model.TravelsthisMonth.Any(t => day.Date >= t.StartDate && day.Date <= t.EndDate && t.ProjId == wp.ProjectId);
                                var timesheetEntry = wp.Timesheets.FirstOrDefault(ts => ts.Day.Date == day.Date);
                                bool hasHours = timesheetEntry != null && timesheetEntry.Hours > 0;
                                bool normallyEditable =
                                (leave?.Type == 11 || leave?.Type == 12) || // Baja parcial
                                (!wp.IsLocked &&
                                !isWeekend &&
                                leave == null &&
                                (!hasTravel || hasTravelforthisProject) &&
                                !isFuture &&
                                !isHoliday);

                                bool editable = !wp.IsLocked && (normallyEditable || hasHours);

                                // Marcar el fondo amarillo solo si NO debería ser editable pero lo es por tener horas
                                bool highlightYellow = !wp.IsLocked && !normallyEditable && hasHours;

                                // Definir el estilo de la celda según las condiciones dadas
                                if (isHoliday)
                                {
                                    cellStyle = "background-color: green;";
                                }
                                else if (hasTravel && !isFuture)
                                {
                                    cellStyle = "background-color: pink;";
                                }
                                else if (isWeekend || isFuture)
                                {
                                    cellStyle = "background-color: #6c757d;";
                                }
                                else if (leave != null)
                                {
                                    switch (leave.Type)
                                    {
                                        case 1:
                                            cellStyle = "background-color: darkorange;";
                                            break;
                                        case 2:
                                            cellStyle = "background-color: lightblue;";
                                            break;
                                        case 3:
                                            cellStyle = "background-color: purple;";
                                            break;
                                        case 11: // Partial Leave - Light Orange
                                        case 12: // Partial Leave - Light Orange
                                            cellStyle = "background-color: lightcoral;";
                                            break;
                                    }
                                }

                                string inputStyle = highlightYellow ? "background-color: yellow;" : "";
                                <td class="hour-input-cell" style="@cellStyle">
                                    @if (editable && (bool?)ViewBag.AllowEdit == true)
                                    {
                                        <input type="text" class="form-control input-hours"
                                               style="@inputStyle"
                                               value="@((timesheetEntry != null) ? timesheetEntry.Hours.ToString("0.##") : "0")"
                                               data-projectid="@wp.ProjectId"
                                               data-wpid="@wp.WpId"
                                               data-day="@day.ToString("yyyy-MM-dd")"
                                               data-original-value="@((timesheetEntry != null) ? timesheetEntry.Hours.ToString("0.##") : "0")" />
                                    }
                                    else
                                    {
                                        <span class="font-weight-bold" style="display: block; text-align: center;">
                                            @((timesheetEntry != null) ? timesheetEntry.Hours.ToString("0.##") : "0")
                                        </span>
                                    }
                                </td>
                            }




                            <td class="sticky-penultimate-column sticky-summary-column">
                                @{
                                    var totalActual = wp.Timesheets.Sum(ts => ts.Hours);
                                    var totalEstimado = wp.EstimatedHours;
                                    var difference = Math.Abs(totalActual - totalEstimado); // diferencia absoluta
                                    string textColor;

                                    if (difference <= 0.5m)
                                    {
                                        textColor = "#006400"; // Verde oscuro
                                    }
                                    else if (totalActual > totalEstimado)
                                    {
                                        textColor = "#FF8C00"; // Naranja oscuro
                                    }
                                    else
                                    {
                                        textColor = "#00008B"; // Azul oscuro
                                    }
                                }
                                <div style="border-bottom: 1px solid #333; margin-bottom: 2px; margin-top: 8px; text-align: center; font-weight: bold; color: @textColor">
                                    @totalActual.ToString("0.#")
                                </div>
                                <div style="text-align: center; font-weight: bold; color: @textColor">
                                    @totalEstimado.ToString("0.#")
                                </div>
                            </td>
                            <td class="sticky-last-column sticky-percent-column">@((wp.Effort * 100).ToString("0.0", CultureInfo.CurrentCulture))</td>
                        </tr>
                    }
                    <!-- Fila de Totales aquí -->
                </tbody>
                <tfoot>
                    <tr style="background-color: #343a40; color: white;">
                        <th class="sticky-column" style="background-color: #343a40; color: white;">Total Daily</th>
                        @foreach (var day in Model.MonthDays)
                        {
                            // Verificar si el día es un día festivo o tiene una ausencia
                            var leave = Model.LeavesthisMonth.FirstOrDefault(l => l.Day.Date == day.Date);
                            bool isHoliday = Model.Holidays.Any(h => h.Date == day);
                            bool isLeave = leave != null && leave.Type != 11 && leave.Type != 12; // No considera parciales como bajas completas

                            // Calcular los totales
                            var totalActualForDay = Model.TotalHoursWithDedication.ContainsKey(day) ? Model.TotalHoursWithDedication[day] : 0;
                            var totalEstimadoForDay = isHoliday || isLeave ? 0 : (Model.HoursPerDayWithDedication.ContainsKey(day) ? Model.HoursPerDayWithDedication[day] : 0);

                            // Para bajas parciales, ajustar el total estimado
                            if (leave?.Type == 11 || leave?.Type == 12)
                            {
                                totalEstimadoForDay = Model.HoursPerDayWithDedication.ContainsKey(day) ? Model.HoursPerDayWithDedication[day] : 0;
                            }

                            string textColorForDay;
                            string backgroundStyle;

                            if (totalActualForDay == totalEstimadoForDay)
                            {
                                textColorForDay = "#006400"; // Verde oscuro
                                backgroundStyle = "background-color: #e6ffe6;";
                            }
                            else if (totalActualForDay > totalEstimadoForDay)
                            {
                                textColorForDay = "#FF8C00"; // Naranja oscuro
                                backgroundStyle = "background-color: #fff0e6;";
                            }
                            else
                            {
                                textColorForDay = "#00008B"; // Azul oscuro
                                backgroundStyle = "background-color: #e6f3ff;";
                            }

                            <td style="@backgroundStyle font-weight: bold; color: @textColorForDay;">
                                <div style="border-bottom: 1px solid black; text-align: center;">
                                    @totalActualForDay.ToString("0.#")
                                </div>
                                <div style="text-align: center;">
                                    @totalEstimadoForDay.ToString("0.#")
                                </div>
                            </td>
                        }
                        <th class="sticky-penultimate-column sticky-summary-column" style="background-color: #343a40; color: white;"></th>
                        <th class="sticky-last-column sticky-percent-column" style="background-color: #343a40; color: white;"></th>
                    </tr>
                </tfoot>



            </table>
            <div class="timesheet-scroll-spacer" aria-hidden="true"></div>
        </div>
    </div>
</div>
<hr/>
<div class="below-main-table">
    <div class="legend-box">
        <h4 class="legend-title">Legend</h4>
        <div class="legend-item"><span class="legend-color legend-leave">&nbsp;</span><span>Leave</span></div>
        <div class="legend-item"><span class="legend-color legend-partial-leave">&nbsp;</span><span>Partial Leave</span></div>
        <div class="legend-item"><span class="legend-color legend-holiday">&nbsp;</span><span>Holiday</span></div>
        <div class="legend-item"><span class="legend-color legend-out-contract">&nbsp;</span><span>Out of contract</span></div>
        <div class="legend-item"><span class="legend-color legend-travel">&nbsp;</span><span>Travel</span></div>
        <div class="legend-item"><span class="legend-color legend-national-holiday">&nbsp;</span><span>National Holiday</span></div>
    </div>
    <div class="travel-table-container">
        <h4 style="margin-bottom: 5px; text-align: center; font-weight: bold">TRAVELS</h4>
        <table class="table table-bordered travels-table">
            <thead>
                <tr>
                    <th>Liquidation Id</th>
                    <th>Project</th>
                    <th>Dedication</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.TravelsthisMonth != null && Model.TravelsthisMonth.Any())
                {
                    foreach (var travel in Model.TravelsthisMonth)
                    {
                        <tr>
                            <td>@travel.LiqId</td>
                            <td>@travel.ProjectSAPCode - @travel.ProjectAcronimo</td>
                            <td>@(travel.Dedication.ToString("0") + "%")</td>
                            <td>@travel.StartDate.ToString("yyyy-MM-dd")</td>
                            <td>@travel.EndDate.ToString("yyyy-MM-dd")</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="5">There are no trips registered for this month</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

</div>
<script>
    document.getElementById('prevMonthButton').addEventListener('click', function () {
        // Asumiendo que tienes un personId y el mes y año actuales disponibles
        var personId = @Model.Person.Id;
        var currentYear = @Model.CurrentYear;
        var currentMonth = @Model.CurrentMonth;

        // Ajusta el año y el mes para el botón Previous
        if (currentMonth === 1) {
            // Si es enero, cambia a diciembre del año anterior
            currentMonth = 12;
            currentYear -= 1;
        } else {
            // En cualquier otro caso, solo disminuye el mes
            currentMonth -= 1;
        }

        // Construye la URL con los parámetros ajustados
        var redirectUrl = `/Timesheet/GetTimeSheetsForPerson?personId=${personId}&year=${currentYear}&month=${currentMonth}`;

        // Redirige a la URL
        window.location.href = redirectUrl;
    });

    document.getElementById('nextMonthButton').addEventListener('click', function () {
        // Asumiendo que tienes un personId y el mes y año actuales disponibles
        var personId = @Model.Person.Id;
        var currentYear = @Model.CurrentYear;
        var currentMonth = @Model.CurrentMonth;

        // Ajusta el año y el mes para el botón Previous
        if (currentMonth === 12) {
            // Si es diciembre, cambia a enero del año siguiente
            currentMonth = 1;
            currentYear += 1;
        } else {
            // En cualquier otro caso, solo disminuye el mes
            currentMonth += 1;
        }

        // Construye la URL con los parámetros ajustados
        var redirectUrl = `/Timesheet/GetTimeSheetsForPerson?personId=${personId}&year=${currentYear}&month=${currentMonth}`;

        // Redirige a la URL
        window.location.href = redirectUrl;
    });


    document.getElementById('monthSelect').value = '@Model.CurrentMonth';
    document.getElementById('yearSelect').value = '@Model.CurrentYear';

    function renderYearQuickSelect() {
        const container = document.getElementById('yearQuickSelectInline');
        if (!container) return;

        const selectedYear = parseInt(document.getElementById('yearSelect').value || '@Model.CurrentYear', 10);
        const years = [selectedYear - 1, selectedYear, selectedYear + 1];
        container.innerHTML = years.map(y =>
            `<button type="button" class="btn btn-sm ${y === selectedYear ? 'btn-primary' : 'btn-outline-primary'}" data-year="${y}">${y}</button>`
        ).join('');

        container.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', function () {
                document.getElementById('yearSelect').value = this.dataset.year;
                renderYearQuickSelect();
            });
        });
    }

    document.getElementById('yearSelect').addEventListener('change', renderYearQuickSelect);
    renderYearQuickSelect();

        document.getElementById('goButton').addEventListener('click', function () {
            var selectedMonth = document.getElementById('monthSelect').value;
            var selectedYear = document.getElementById('yearSelect').value;

            // Asumiendo que tienes un personId disponible, por ejemplo, guardado en un data attribute en algún lugar
            var personId = @Model.Person.Id

            // Construye la URL con los parámetros seleccionados
            var redirectUrl = `/Timesheet/GetTimeSheetsForPerson?personId=${personId}&year=${selectedYear}&month=${selectedMonth}`;

            // Redirige a la URL
            window.location.href = redirectUrl;
        });


    document.getElementById('saveAllButton')?.addEventListener('click', function () {
        var changedTimesheets = [];
        var invalidInputs = [];

        document.querySelectorAll('.input-hours').forEach(input => {
            // Reemplaza la coma por un punto para asegurar el correcto parsing del valor decimal
            var originalValue = input.getAttribute('data-original-value').replace(',', '.');
            var currentValue = input.value.replace(',', '.');

            // Parsea ambos valores como flotantes
            originalValue = parseFloat(originalValue);
            currentValue = parseFloat(currentValue);

            // Validación de que el valor sea entero o decimal con .5
                if (isNaN(currentValue) || currentValue < 0) {
                    invalidInputs.push(input);
                } else {
                if (Math.round(currentValue * 100) / 100 !== Math.round(originalValue * 100) / 100) {
                    changedTimesheets.push({
                        ProjectId: parseInt(input.getAttribute('data-projectid'), 10),
                        WpId: parseInt(input.getAttribute('data-wpid'), 10),
                        PersonId: @Model.Person.Id,
                        Day: input.getAttribute('data-day'),
                        Hours: currentValue
                    });
                }
            }
        });

        if (invalidInputs.length > 0) {
            alert('Some inputs are invalid. Please enter a positive number.');
            invalidInputs.forEach(input => input.classList.add('is-invalid'));
        } else {
            if (changedTimesheets.length > 0) {
                fetch('@Url.Action("SaveTimesheetHours", "Timesheet")', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ TimesheetDataList: changedTimesheets })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Timesheets updated successfully.');
                            location.reload();
                        } else {
                            alert('Error saving timesheets.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('There was an error processing your request.');
                    });
            } else {
                alert('No changes to save.');
            }
        }
    });

    $(document).ready(function () {
        var table = $('#timesheetTable tbody');
        var rows = table.find('tr').get();

        rows.sort(function (a, b) {
            var projectA = $(a).find('td').eq(0).find('div').eq(0).text().match(/\(([^)]+)\)/)[1].toUpperCase();
            var projectB = $(b).find('td').eq(0).find('div').eq(0).text().match(/\(([^)]+)\)/)[1].toUpperCase();
            var wpA = $(a).find('td').eq(0).find('div').eq(1).text().split(' ')[0].toUpperCase();
            var wpB = $(b).find('td').eq(0).find('div').eq(1).text().split(' ')[0].toUpperCase();

            // Ordenar por ProjectName
            if (projectA < projectB) return -1;
            if (projectA > projectB) return 1;

            // Ordenar por WpName, pero mantener "TRAVELS" al final
            if (wpA === 'TRAVELS') return 1;
            if (wpB === 'TRAVELS') return -1;

            if (wpA < wpB) return -1;
            if (wpA > wpB) return 1;

            return 0;
        });



        $.each(rows, function (index, row) {
            table.append(row);
        });
    });

    document.getElementById('autoFillButton')?.addEventListener('click', async function () {
        const personId = @Model.Person.Id;
        const year = @Model.CurrentYear;
        const month = @Model.CurrentMonth;

        if (!confirm(`Are you sure you want to automatically fill in the timesheet for ${month}/${year}? This action may overwrite existing data.`)) return;


        const response = await fetch('/Timesheet/AutoFillTimesheetForPersonAndMonth', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                personId: personId,
                targetMonth: `${year}-${String(month).padStart(2, '0')}-01T00:00:00`
            })
        });

        const result = await response.json();
        alert(result.message);

        if (result.success) {
            location.reload(); // recarga para reflejar los cambios
        }
    });

</script>






<style>
    .single-line-cell {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-weight: bold;
        text-align: center;
        vertical-align: middle;
        max-width: 560px;
        padding-left: 14px !important;
        padding-right: 16px !important;
        box-sizing: border-box;
    }


    .wp-title-cell {
        text-align: center;
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        padding: 0 16px;
    }
    .second-line-cell {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-weight: bold;
        text-align: center;
        vertical-align: middle;
        max-width: 500px;
        max-height: 10px;
    }

    .table-responsive {
        overflow: visible;
        margin-bottom: 1rem;
        padding-left: 0;
        padding-right: 0;
    }

    .scrollable-table-container {
        max-height: 800px;
        overflow-y: auto;
        overflow-x: auto;
        position: relative;
        margin-bottom: 10px;
        overscroll-behavior: contain;
    }

    .timesheet-scroll-spacer {
        height: 14px;
        min-height: 14px;
    }

    .table {
        width: max-content;
        min-width: 100%;
        margin-bottom: 0;
        color: #212529;
        border-collapse: separate;
        border-spacing: 0;
    }

        .table td {
            padding: 8px; /* Ajusta el padding para permitir el centrado vertical */
            vertical-align: middle; /* Asegura que el contenido de la celda se alinee verticalmente en el centro */
            text-align: center; /* Alinea el contenido de la celda horizontalmente en el centro */
        }

    .table-bordered {
        border: 1px solid #dee2e6;
    }

    .table-striped tbody tr:nth-of-type(odd) {
        background-color: rgba(0, 0, 0, 0.05);
    }

    .table-hover tbody tr:hover {
        color: #212529;
        background-color: rgba(0, 0, 0, 0.075);
    }

    .thead-dark th {
        color: #fff;
        background-color: #343a40;
        border-color: #454d55;
        text-align: center; /* Centra el texto horizontalmente */
        vertical-align: middle; /* Centra el texto verticalmente */
    }

    th, td {
        text-align: center; /* Centra el texto horizontalmente */
        vertical-align: middle; /* Centra el texto verticalmente */
    }

    .table thead th {
        position: sticky;
        top: 0;
        z-index: 2; /* Asegura que la fila se mantenga sobre el contenido scrolleable */
    }

    .hour-input-cell {
        width: 75px;
        min-width: 75px;
        max-width: 75px;
        padding: .3rem;
        text-align: center;
        vertical-align: middle;
        line-height: 0.75;
    }

    .input-hours {
        width: 100%;
        border: 1px solid #ced4da;
        line-height: 0.75;
        padding: .375rem .75rem;
        text-align: center;
        vertical-align: middle;
    }

    /* Estilos para las celdas según el tipo de ausencia */
    .leave-absence {
        background-color: lightsalmon;
    }

    .personal-holiday {
        background-color: lightblue;
    }

    .out-of-contract {
        background-color: purple;
    }

    /* Estilo para días de viaje */
    .travel-day {
        background-color: lightgreen;
    }

        /* Asegura que los inputs en celdas de fin de semana o días no editables no sean modificables */
        .bg-secondary input, .leave-absence input, .personal-holiday input, .out-of-contract input, .travel-day input {
            pointer-events: none;
            background-color: inherit; /* Hace que el input sea transparente al color de fondo de la celda */
        }

    /* Establece un ancho fijo para la primera columna */
    .table .first-column {
        width: 200px; /* Define el ancho fijo */
        max-width: 200px; /* Previene que la celda se expanda más de lo necesario */
    }

    .bg-secondary, .leave-absence, .personal-holiday, .out-of-contract, .travel-day {
        pointer-events: none;
        background-color: inherit; /* Hace que el input sea transparente al color de fondo de la celda */
    }

    /* Estilos para resaltar las celdas según su estado */
    .leave-absence {
        background-color: lightsalmon;
    }

    .personal-holiday {
        background-color: lightblue;
    }

    .out-of-contract {
        background-color: purple;
    }

    .travel-day {
        background-color: lightgreen;
    }

    .effort-match, .effort-mismatch {
        font-weight: bold;
    }

    .effort-match {
        background-color: #90ee90;
        color: darkgreen;
    }

    .effort-mismatch {
        background-color: #ffcccc;
        color: darkred;
    }

    h2 {
        text-align: center;
        font-weight: bold;
        margin-top: 5px;
    }

    .d-flex.align-items-center select.form-control,
    .d-flex.align-items-center button.btn {
        height: calc(2.25rem + 2px); /* Asegura que todos los elementos tengan la misma altura */
        margin-bottom: 0; /* Elimina el margen inferior por defecto para los elementos del formulario */
    }

    /* Espaciado entre elementos para una mejor distribución y alineación */
    .mx-2 {
        margin-left: .5rem !important;
        margin-right: .5rem !important;
    }

    .sticky-column {
        position: sticky;
        left: 0;
        background-color: white;
        z-index: 5;
    }

    .sticky-header {
        position: sticky;
        top: 0;
        background-color: #343a40;
        z-index: 6;
    }

    .sticky-day-header {
        z-index: 4; /* Menor que top-left sticky header */
        background-color: #343a40;
    }

    tfoot th {
        bottom: 0;
        top: auto;
        z-index: 2;
    }




    .below-main-table {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 18px;
        margin-top: 10px;
    }

    .travel-table-container {
        flex: 1 1 auto;
        min-width: 0;
        overflow-x: auto;
        margin: 0;
    }

    .travels-table {
        width: 100% !important;
        min-width: 760px !important;
    }

    .legend-box {
        width: 320px;
        margin-left: 10px;
        padding: 14px;
        margin-top: 10px;
        border: 1px solid #d7e6f3;
        border-radius: 12px;
        box-shadow: 0 8px 18px rgba(14, 57, 98, .10);
        background: linear-gradient(180deg, #ffffff 0%, #f7fbff 100%);
    }

    .legend-title {
        margin-bottom: 14px;
        text-align: center;
        font-weight: 700;
        color: #154f82;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
        font-weight: 500;
        color: #1f4566;
    }

    .legend-color {
        display: inline-block;
        width: 18px;
        height: 18px;
        border-radius: 4px;
        border: 1px solid rgba(0,0,0,.3);
    }

    .legend-leave { background-color: darkorange; }
    .legend-partial-leave { background-color: lightcoral; }
    .legend-holiday { background-color: lightblue; }
    .legend-out-contract { background-color: red; }
    .legend-travel { background-color: pink; }
    .legend-national-holiday { background-color: green; }

    :root {
        --timesheet-percent-col-width: 56px;
        --timesheet-summary-col-width: 130px;
    }

    .sticky-penultimate-column {
        position: sticky;
        right: var(--timesheet-percent-col-width);
        background-color: #ffffff !important;
        z-index: 10;
        min-width: var(--timesheet-summary-col-width);
        width: var(--timesheet-summary-col-width);
        max-width: var(--timesheet-summary-col-width);
        padding-left: 6px !important;
        padding-right: 6px !important;
        box-sizing: border-box;
        box-shadow: -1px 0 0 #c9d0d8 inset, 1px 0 0 #c9d0d8 inset;
    }

    .sticky-last-column {
        position: sticky;
        right: 0;
        background-color: #ffffff !important;
        z-index: 9;
        min-width: var(--timesheet-percent-col-width);
        width: var(--timesheet-percent-col-width);
        max-width: var(--timesheet-percent-col-width);
        padding-left: 6px !important;
        padding-right: 6px !important;
        box-sizing: border-box;
        box-shadow: -1px 0 0 #c9d0d8 inset, 1px 0 0 #c9d0d8 inset;
    }


    tfoot .sticky-summary-column,
    tfoot .sticky-percent-column {
        background-color: #343a40 !important;
        color: #ffffff !important;
    }

    .sticky-summary-column {
        background-clip: padding-box;
    }

    .sticky-percent-column {
        background-clip: padding-box;
    }


    .timesheet-ux {
        margin-top: 8px;
    }

    .timesheet-page-title {
        text-align: center;
        font-weight: 700;
        margin-bottom: 14px;
        color: #fff;
        background: linear-gradient(135deg, #0e4f86 0%, #1b6dac 100%);
        border-radius: 12px;
        padding: 12px 16px;
        box-shadow: 0 8px 20px rgba(12, 56, 96, 0.16);
    }

    .timesheet-control-panel {
        display: flex;
        align-items: center;
        gap: 12px;
        border: 1px solid #d7e6f3;
        border-radius: 12px;
        background: #fff;
        padding: 12px;
        box-shadow: 0 8px 20px rgba(14, 57, 98, 0.08);
        flex-wrap: nowrap;
        overflow-x: auto;
        white-space: nowrap;
    }

    .timesheet-nav-group,
    .timesheet-actions-group {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        flex-wrap: nowrap;
    }

    .timesheet-nav-group .form-control {
        width: auto;
        min-width: 140px;
    }

    .year-quick-select-inline {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-left: 2px;
    }

    .timesheet-progress-wrap {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        min-width: 760px;
        margin-left: auto;
        flex: 1 1 auto;
    }

    .timesheet-progress-bar {
        min-width: 520px;
        width: 100%;
        margin-bottom: 0;
    }

    .total-hours-label {
        margin-bottom: 0;
    }

    .top-left-header {
        z-index: 9 !important;
        background-color: #343a40 !important;
        box-shadow: 2px 0 0 #fff;
    }

    thead .sticky-penultimate-column,
    thead .sticky-last-column {
        background-color: #343a40 !important;
        color: #fff !important;
        z-index: 40 !important;
    }

    tbody .sticky-summary-column,
    tbody .sticky-percent-column {
        z-index: 10 !important;
    }


    .header-top-line {
        border-bottom: 1px solid #ffffff;
        margin-bottom: 2px;
        margin-top: 8px;
        text-align: center;
    }

    .body-top-line {
        border-bottom-color: #000000;
    }

    .timesheet-help {
        position: relative;
        z-index: 30;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        width: 18px;
        height: 18px;
        margin-left: 6px;
        border-radius: 50%;
        background: #ffffff;
        color: #0e4f86;
        border: 1px solid #b9d0e6;
        font-size: .75rem;
        cursor: help;
        font-weight: 700;
    }



    .timesheet-help:hover,
    .timesheet-help:focus {
        background: #0e4f86;
        color: #fff;
        outline: none;
    }

    .timesheet-help::after,
    .timesheet-help::before {
        opacity: 0;
        pointer-events: none;
        transition: opacity .15s ease;
        position: absolute;
        z-index: 9999;
    }

    .timesheet-help::after {
        content: attr(data-tooltip);
        width: 320px;
        background: #123f68;
        color: #fff;
        font-size: .78rem;
        line-height: 1.35;
        padding: 8px 10px;
        border-radius: 8px;
        top: calc(100% + 8px);
        right: calc(100% - 6px);
        box-shadow: 0 8px 18px rgba(0,0,0,.25);
        white-space: normal;
        text-align: left;
    }

    .timesheet-help::before {
        content: "";
        border: 6px solid transparent;
        border-bottom-color: #123f68;
        top: calc(100% - 4px);
        right: calc(100% + 8px);
    }

    .timesheet-help:hover::after,
    .timesheet-help:hover::before,
    .timesheet-help:focus::after,
    .timesheet-help:focus::before {
        opacity: 1;
    }

    @@media (max-width: 1200px) {
        .below-main-table {
            flex-direction: column;
        }

        .travel-table-container {
            width: 100%;
        }

        .timesheet-progress-wrap {
            min-width: 420px;
        }

        .timesheet-progress-bar {
            min-width: 250px;
        }

        .timesheet-help::after {
            right: calc(100% - 4px);
            top: calc(100% + 8px);
            width: min(300px, 68vw);
        }
    }

</style>





